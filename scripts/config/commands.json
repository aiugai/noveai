{
  "dev": {
    "backend": {
      "command": "npx nx dev backend",
      "app": "backend",
      "ports": [
        3005
      ],
      "description": "启动后端开发服务"
    },
    "front": {
      "command": "npx nx dev front",
      "app": "front",
      "ports": [
        3006
      ],
      "description": "启动前端开发服务"
    },
    "admin": {
      "command": "npx nx dev admin-front",
      "app": "admin-front",
      "ports": [
        3505
      ],
      "description": "启动管理后台开发服务"
    },
    "all": {
      "concurrent": true,
      "commands": [
        "dev.backend",
        "dev.front",
        "dev.admin"
      ],
      "description": "同时启动所有开发服务",
      "interactive": true
    }
  },
  "build": {
    "backend": {
      "dev": {
        "command": "npx nx build backend --configuration=development",
        "app": "backend",
        "description": "构建后端(开发环境)"
      },
      "prod": {
        "command": "npx nx build backend --configuration=production",
        "app": "backend",
        "description": "构建后端(生产环境)"
      }
    },
    "shared": {
      "command": "npx nx build shared",
      "description": "构建共享包 @ai/shared"
    },
    "front": {
      "dev": {
        "command": "npx nx build front --configuration=development",
        "app": "front",
        "description": "构建前端(开发环境)"
      },
      "prod": {
        "command": "npx nx run front:exportDist",
        "app": "front",
        "description": "构建并导出前端到 dist/front (生产环境)"
      }
    },
    "admin": {
      "dev": {
        "command": "npx nx build admin-front --configuration=development",
        "app": "admin-front",
        "description": "构建管理后台(开发环境)"
      },
      "prod": {
        "command": "npx nx run admin-front:exportDist",
        "app": "admin-front",
        "description": "构建管理后台(生产环境)"
      }
    },
    "all": {
      "dev": {
        "sequential": true,
        "commands": [
          "build.backend.dev",
          "build.parallelWeb.dev"
        ],
        "description": "构建所有应用(开发环境，Web并行)"
      },
      "prod": {
        "sequential": true,
        "commands": [
          "build.backend.prod",
          "build.parallelWeb.prod"
        ],
        "description": "构建所有应用(生产环境，Web并行)"
      }
    },
    "parallelWeb": {
      "dev": {
        "concurrent": true,
        "commands": [
          "build.shared",
          "build.front.dev",
          "build.admin.dev"
        ],
        "description": "并行构建 Web（shared/front/admin 开发环境）"
      },
      "prod": {
        "concurrent": true,
        "commands": [
          "build.shared",
          "build.front.prod",
          "build.admin.prod"
        ],
        "description": "并行构建 Web（shared/front/admin 生产环境）"
      }
    },
    "affected": {
      "dev": {
        "command": "npx nx affected -t build --configuration=development --parallel=3",
        "description": "仅构建受影响项目(开发环境)"
      },
      "prod": {
        "command": "npx nx affected -t build --configuration=production --parallel=3",
        "description": "仅构建受影响项目(生产环境)"
      }
    }
  },
  "db": {
    "generate": {
      "command": "npx nx prisma:generate backend",
      "app": "backend",
      "description": "生成Prisma客户端"
    },
    "migrate": {
      "dev": {
        "command": "npx nx prisma:migrate:dev backend",
        "app": "backend",
        "description": "执行数据库迁移(开发环境)"
      },
      "e2e": {
        "command": "npx nx prisma:migrate:deploy backend",
        "app": "backend",
        "description": "执行数据库迁移(E2E测试环境)"
      },
      "prod": {
        "command": "npx nx prisma:migrate:deploy backend",
        "app": "backend",
        "dangerous": true,
        "description": "执行数据库迁移(生产环境)"
      }
    },
    "reset": {
      "dev": {
        "command": "npx nx prisma:migrate:reset backend",
        "app": "backend",
        "dangerous": true,
        "description": "重置数据库(开发环境)"
      },
      "e2e": {
        "command": "npx nx prisma:migrate:reset backend",
        "app": "backend",
        "dangerous": true,
        "description": "重置数据库(E2E测试环境)"
      },
      "prod": {
        "command": "npx nx prisma:migrate:reset backend",
        "app": "backend",
        "dangerous": true,
        "description": "重置数据库(生产环境)"
      }
    },
    "seed": {
      "dev": {
        "command": "npx nx prisma:db:seed backend",
        "app": "backend",
        "description": "填充数据库(开发环境)"
      },
      "e2e": {
        "command": "npx nx prisma:db:seed backend",
        "app": "backend",
        "description": "填充数据库(E2E测试环境)"
      },
      "prod": {
        "command": "npx nx prisma:db:seed backend",
        "app": "backend",
        "description": "填充数据库(生产环境)"
      }
    },
    "format": {
      "command": "npx nx prisma:format backend",
      "description": "格式化Prisma schema文件"
    },
    "script": {
      "dev": {
        "command": "pnpm --filter ./apps/backend exec ts-node -r tsconfig-paths/register prisma/scripts/{SCRIPT_NAME}.ts",
        "app": "backend",
        "description": "运行数据库脚本(开发环境)"
      },
      "prod": {
        "command": "pnpm --filter ./apps/backend exec ts-node -r tsconfig-paths/register prisma/scripts/{SCRIPT_NAME}.ts",
        "app": "backend",
        "dangerous": true,
        "description": "运行数据库脚本(生产环境)"
      }
    }
  },
  "test": {
    "e2e": {
      "backend": {
        "command": "npx nx test:e2e backend",
        "app": "backend",
        "description": "运行后端E2E测试"
      },
      "all": {
        "command": "npx nx test:e2e backend",
        "app": "backend",
        "description": "运行所有E2E测试"
      }
    },
    "unit": {
      "backend": {
        "command": "npx nx test backend",
        "app": "backend",
        "description": "运行后端单元测试"
      }
    }
  },
  "lint": {
    "command": "npx nx run-many -t lint",
    "description": "运行代码检查",
    "skipEnvValidation": true
  },
  "start": {
    "backend": {
      "dev": {
        "command": "pnpm --filter ./apps/backend run start",
        "app": "backend",
        "description": "启动后端开发服务（单次运行，无热重载）"
      },
      "prod": {
        "command": "npx nx start backend",
        "app": "backend",
        "description": "启动后端生产服务"
      }
    },
    "front": {
      "dev": {
        "command": "npx nx dev front",
        "app": "front",
        "ports": [
          3006
        ],
        "description": "启动前端开发服务（开发环境）"
      },
      "prod": {
        "command": "npx nx start front",
        "app": "front",
        "ports": [
          3006
        ],
        "description": "启动前端生产服务（SSR，依赖构建）"
      }
    },
    "dev": {
      "command": "node scripts/lib/start-dev.js",
      "description": "启动完整开发环境（集成start-dev.sh功能）",
      "interactive": true
    },
    "stagewise-front": {
      "command": "npx stagewise@latest -b -s -a 3006 -p 3007 -w ./apps/front",
      "description": "Stagewise 桥接 front (3006→3007)",
      "ports": [
        3007
      ]
    },
    "stagewise-admin": {
      "command": "npx stagewise@latest -b -s -a 3505 -p 3506 -w ./apps/admin-front",
      "description": "Stagewise 桥接 admin-front (3505→3506)",
      "ports": [
        3506
      ]
    }
  },
  "clean": {
    "all": {
      "command": "npx nx run-many -t clean",
      "description": "清理所有构建文件"
    },
    "deps": {
      "command": "rm -rf node_modules && pnpm install",
      "description": "清理并重新安装依赖",
      "dangerous": true
    }
  },
  "cache": {
    "clear": {
      "command": "set -e; npx nx reset; pnpm store prune || true; STORE_PATH=$(pnpm store path 2>/dev/null || echo ''); if [ -n \"$STORE_PATH\" ] && [ -d \"$STORE_PATH\" ]; then echo \"移除 PNPM store: $STORE_PATH\"; rm -rf \"$STORE_PATH\"; fi; rm -rf .nx/cache node_modules/.cache ~/.pnpm-store || true; echo 'Nx 与依赖缓存已清理'",
      "description": "清除 Nx 缓存与依赖库缓存 (pnpm store / 本地缓存)",
      "dangerous": true
    }
  }
}
